{"id":"zen-01q","title":"Add test for VerifyTimeout exception - verify it's raised when Claude returns no output","description":"","notes":"Added TestVerifyTimeoutException with 4 tests including phase_verify raises on no output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T07:24:53.0464489-05:00","updated_at":"2025-12-25T08:18:08.572006-05:00","closed_at":"2025-12-25T08:18:08.572006-05:00"}
{"id":"zen-0da","title":"verify.py uses MODEL_HANDS instead of MODEL_EYES for running tests - design doc specifies haiku but code uses sonnet","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T07:24:39.9256492-05:00","updated_at":"2025-12-25T07:30:24.235132-05:00","closed_at":"2025-12-25T07:30:24.235132-05:00"}
{"id":"zen-10o","title":"Extract judge.py from core.py","description":"","notes":"Created judge.py with build_judge_prompt(), build_judge_fix_prompt(), _git_has_head(), _git_is_repo(), _is_test_or_doc(), should_skip_judge_ctx(), phase_judge_ctx(). Core.py keeps original functions during transition.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:07.1339375-05:00","updated_at":"2025-12-24T20:46:25.9046057-05:00","closed_at":"2025-12-24T20:46:25.9046057-05:00","labels":["phase-0","refactor"]}
{"id":"zen-1t9","title":"Phase 1: Build standalone test runner - detect project type, run tests via subprocess, parse results (prove concept)","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T07:35:20.6479225-05:00","updated_at":"2025-12-25T07:35:20.6479225-05:00","labels":["needs-planning"]}
{"id":"zen-1xc","title":"Detect task completion from previous zen run","description":"At the beginning of a zen run, detect if the previous run already completed the task. Prevents redundant work when resuming.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T19:17:36.527424-05:00","updated_at":"2025-12-23T19:40:23.2110785-05:00","closed_at":"2025-12-23T19:40:23.2110785-05:00","close_reason":"Implemented using final_notes.md cost summary detection. Added _check_previous_completion() and 3 unit tests.","labels":["enhancement","p1"]}
{"id":"zen-241","title":"Phase 3: Integrate test runner with scout.md - verify reads project info from scout output and runs tests directly","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T07:35:32.9492038-05:00","updated_at":"2025-12-25T07:35:32.9492038-05:00","labels":["needs-planning"]}
{"id":"zen-2ak","title":"Plan: Fix version mismatch - single source of truth","description":"Root cause: Version defined in two places. Solution: Use importlib.metadata to read version from pyproject.toml at runtime, or use a build-time injection. Files: __init__.py, pyproject.toml. Verification: zen --version shows correct version.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T08:10:34.9640567-05:00","updated_at":"2025-12-27T08:36:29.0026441-05:00","closed_at":"2025-12-27T08:36:29.0026441-05:00","dependencies":[{"issue_id":"zen-2ak","depends_on_id":"zen-fca","type":"blocks","created_at":"2025-12-27T08:11:58.5167411-05:00","created_by":"daemon"}]}
{"id":"zen-329","title":"Add parse_targeted_files helper to utils.py","description":"Extract file paths from ## Targeted Files section of scout.md. See docs/plan.md Step 2.2","notes":"Implemented in scout.py:17 instead of utils.py - scout-specific so kept with scout module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:57.2285008-05:00","updated_at":"2025-12-25T13:23:12.4682522-05:00","closed_at":"2025-12-25T14:00:00-05:00","labels":["enhancement","phase-2"]}
{"id":"zen-33d","title":"Systemic: Excessive sys.exit() calls (28 occurrences) - hard to test error paths","description":"28 sys.exit() calls scattered across core.py, cli.py, scout.py, claude.py, plan.py, implement.py, judge.py. Makes library unusable - callers can't catch errors. Makes testing error paths require subprocess spawning.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:18.5259492-05:00","updated_at":"2025-12-27T08:14:01.3047764-05:00"}
{"id":"zen-3m0","title":"Phase 2: Add project type and test command detection to scout prompt output","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T07:35:26.2706971-05:00","updated_at":"2025-12-25T07:35:26.2706971-05:00","labels":["needs-planning"]}
{"id":"zen-3n0","title":"Investigate scout.py grep_impact - improve cross-language file reference detection","description":"","notes":"grep_impact() currently hardcodes *.py for file search. zen supports all languages, so this needs a smarter approach. Options: 1) Derive extension from target file, 2) Use language-aware patterns, 3) Search all text files. Need to consider performance (searching all files could be slow) vs coverage.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T07:50:17.2038554-05:00","updated_at":"2025-12-26T07:50:32.5498178-05:00"}
{"id":"zen-3q7","title":"Anti-Pattern: verify.py imports PROJECT_ROOT, WORK_DIR at module level from config","description":"verify.py imports PROJECT_ROOT, WORK_DIR, TEST_OUTPUT_PATH_STR from config at module level. These are mutable globals set by core.py run(). Makes verify.py dependent on core.py initialization order and breaks standalone testing.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:49.024113-05:00","updated_at":"2025-12-27T08:15:53.4099352-05:00"}
{"id":"zen-4q0","title":"Add grep_impact for Golden Rule enforcement","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:08.7701515-05:00","updated_at":"2025-12-24T20:55:39.7463949-05:00","closed_at":"2025-12-24T20:55:39.7463949-05:00","labels":["enhancement","phase-0"]}
{"id":"zen-4qg","title":"Optimize CLAUDE.md usage across phases","description":"All phases should see BOTH constitutions:\n1. Zen defaults/CLAUDE.md - consistent process/philosophy\n2. Project CLAUDE.md - project-specific rules\n\nCurrent state (broken):\n- Plan: zen defaults only\n- Implement: zen defaults only  \n- Judge: project CLAUDE.md only\n\nDesired state:\n- Plan: zen defaults + project CLAUDE.md\n- Implement: zen defaults + project CLAUDE.md\n- Judge: zen defaults + project CLAUDE.md\n\nFix: Create helper that merges both, use in all three phases.","notes":"Implemented get_full_constitution() that merges zen defaults + project CLAUDE.md (or AGENTS.md fallback). Updated plan.py, implement.py, and judge.py to use it. All phases now see both constitutions. Added 5 tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T12:38:38.2144015-05:00","updated_at":"2025-12-26T14:52:14.2289816-05:00","closed_at":"2025-12-26T14:52:14.2289816-05:00"}
{"id":"zen-4qp","title":"Add interface-first enforcement to plan validation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:10.53507-05:00","updated_at":"2025-12-24T21:25:14.7486372-05:00","closed_at":"2025-12-24T21:25:14.7486372-05:00","labels":["enhancement","phase-0"]}
{"id":"zen-4u0","title":"Plan: Replace sys.exit with exceptions","description":"Solution: 1) Define exception hierarchy (ZenError base, ScoutError, PlanError, etc.). 2) Replace sys.exit(1) with raise XxxError. 3) Single try/except in cli.py main() that catches ZenError and calls sys.exit. 4) Update tests to assert exceptions instead of exit codes. Files: All modules, new exceptions.py. Risk: Medium - behavior change. Verification: Tests pass, errors raise exceptions, CLI still exits correctly.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:14:02.4656672-05:00","updated_at":"2025-12-27T08:14:02.4656672-05:00","dependencies":[{"issue_id":"zen-4u0","depends_on_id":"zen-33d","type":"blocks","created_at":"2025-12-27T08:14:13.8894087-05:00","created_by":"daemon"}]}
{"id":"zen-5e5","title":"Linter: Per-line disable comments","description":"Add syntax: secret = 'x' # zenlint: ignore POSSIBLE_SECRET. Implementation: IGNORE_PATTERN = re.compile(r'#\\s*zenlint:\\s*ignore\\s+(\\w+)'). Location: src/zen_mode/linter.py. Effort: ~20 LOC","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T19:17:41.856418-05:00","updated_at":"2025-12-23T20:48:16.1621348-05:00","closed_at":"2025-12-23T20:48:16.1621348-05:00","labels":["enhancement","p2"]}
{"id":"zen-5rl","title":"Anti-Pattern: Global state mutation in core.py (9 globals in run function)","description":"core.py run() declares 9 globals and mutates them: WORK_DIR, SCOUT_FILE, PLAN_FILE, LOG_FILE, NOTES_FILE, BACKUP_DIR, TEST_OUTPUT_FILE, JUDGE_FEEDBACK_FILE, ALLOWED_FILES. This enables the legacy API but prevents concurrent runs and complicates testing.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:13.4379332-05:00","updated_at":"2025-12-27T08:13:12.7017171-05:00"}
{"id":"zen-5sf","title":"Anti-Pattern: swarm.py uses global _prev_line_count for status display state","description":"swarm.py uses global _prev_line_count to track terminal status display state between print_status_block calls. Makes function impure and complicates testing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:50.5625212-05:00","updated_at":"2025-12-27T10:26:58.5091378-05:00","closed_at":"2025-12-27T10:26:58.5091378-05:00"}
{"id":"zen-5yo","title":"Extract implement.py from core.py","description":"","notes":"Created implement.py with run_linter_with_timeout(), backup_scout_files_ctx(), build_verify_prompt(), build_implement_prompt(), build_escalation_suffix(), phase_implement_ctx(). Legacy wrappers provided. Core.py keeps original functions during transition.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:05.3670404-05:00","updated_at":"2025-12-24T20:41:54.1702095-05:00","closed_at":"2025-12-24T20:41:54.1702095-05:00","labels":["phase-0","refactor"]}
{"id":"zen-6a5","title":"Extract Context dataclass from utils.py to context.py","description":"Move Context dataclass from utils.py to dedicated context.py module. Update imports across codebase.","notes":"Created context.py with Context dataclass. utils.py re-exports for backward compatibility. All imports still work.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-26T06:21:21.7720187-05:00","updated_at":"2025-12-26T15:12:32.7532082-05:00","closed_at":"2025-12-26T15:12:32.7532082-05:00","labels":["refactor"]}
{"id":"zen-6e6","title":"Inject zen constitution into PLAN prompt","description":"Extract ARCHITECTURE and PROCESS sections from defaults/CLAUDE.md and inject into plan prompt. See docs/plan.md Step 1.1","notes":"Added load_constitution() to utils.py with 9 tests. Plan prompt now injects GOLDEN RULES, ARCHITECTURE, PROCESS. Added header format (Goal/Architecture/Dependencies). Created docs/prompts.md reference.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:32.3423426-05:00","updated_at":"2025-12-25T13:13:17.8571649-05:00","closed_at":"2025-12-25T13:00:00-05:00","labels":["enhancement","phase-1"]}
{"id":"zen-90k","title":"Capture lint baseline after scout completes","description":"Run linter on targeted files after scout and store baseline. Enables ratchet model.\n\nDECISIONS:\n- New module: ratchet.py (keeps linter pure, phases focused)\n- Storage: .zen/lint_baseline.json (structured, not in scout.md)\n- Format: {(file, rule): count} - ignores line numbers for shift tolerance\n- Logging: Progress to log.md via log(), e.g. '[BASELINE] Captured 3 pre-existing violations'\n\nPLANNING ITEMS:\n(1) Handle missing files gracefully\n(2) Test with empty baseline\n(3) Test with pre-existing violations\n(4) Fallback if linter unavailable - warn, don't block\n(5) Clear logging of what baseline captured","notes":"Created ratchet.py with capture_baseline() and load_baseline(). Integrated into scout.py after targeted files parsed. Added baseline_file property to Context. 24 tests in test_ratchet.py. Next: zen-9qs implements check_ratchet() for implement phase.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:55.9801595-05:00","updated_at":"2025-12-26T19:46:04.2475448-05:00","closed_at":"2025-12-26T21:00:00-05:00","labels":["enhancement","phase-2"]}
{"id":"zen-982","title":"Systemic: Print statements used throughout for logging (should use logging module)","description":"Print statements used for user output throughout cli.py, core.py, claude.py, files.py, linter.py, judge.py, swarm.py, implement.py. No log levels, no way to suppress, no structured output. Makes library integration messy.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:36.4290012-05:00","updated_at":"2025-12-27T08:14:15.3721831-05:00"}
{"id":"zen-9dg","title":"Weak Test: conftest.py allow_real_api_calls fixture is incomplete (does nothing)","description":"conftest.py defines allow_real_api_calls fixture but it just passes - doesn't actually undo the autouse block_real_api_calls patch. Tests using this fixture still get blocked.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:31.3057259-05:00","updated_at":"2025-12-27T08:36:33.1415468-05:00","closed_at":"2025-12-27T08:36:33.1420768-05:00"}
{"id":"zen-9k9","title":"Phase 3 requirement: Fallback to LLM-based verify if direct test runner fails (unknown project, command error, parse failure)","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T07:37:56.3334838-05:00","updated_at":"2025-12-25T07:37:56.3334838-05:00","labels":["needs-planning"]}
{"id":"zen-9qs","title":"Implement categorized delta lint ratchet in implement phase","description":"Compare current violations to baseline, only fail on NEW violations.\n\nDECISIONS:\n- Module: ratchet.py with check_ratchet(baseline, paths) -\u003e (passed, report)\n- Replaces current run_linter_with_timeout() call in implement.py\n- Log format: '[RATCHET] Pass (0 new)' or '[RATCHET] Fail (2 new)' + details\n- Retry logic unchanged - just definition of 'passed' changes\n\nEDGE CASES:\n(1) File renamed - treat as new file (safe default)\n(2) File deleted - ignore, no violations possible\n(3) Violation fixed then reintroduced same step - counts as new (correct)\n(4) Ratchet check errors - warn but don't block\n(5) Baseline missing for new file - all violations are 'new'\n\nTESTING:\n- Multiple files, mixed results\n- Empty baseline\n- Pre-existing violations pass through\n- New violations block","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:58.5287746-05:00","updated_at":"2025-12-26T19:29:00.7952348-05:00","labels":["enhancement","phase-2"]}
{"id":"zen-9u5","title":"Lint: Unicode warning in test_verify_languages.py during subprocess handling","description":"test_verify_languages.py produces UnicodeDecodeError warning on Windows when subprocess output contains non-cp1252 characters. Happens in _readerthread during Jest test simulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:37.9556881-05:00","updated_at":"2025-12-27T09:11:38.6756589-05:00","closed_at":"2025-12-27T09:11:38.6756589-05:00"}
{"id":"zen-9vk","title":"Failure-triggered pause after consecutive retries","description":"After 2 consecutive retries on different steps, pause and log: '[CHECKPOINT] Multiple retries detected. Something may be wrong with plan.' Prevents infinite loop token burn.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T19:17:40.7263494-05:00","updated_at":"2025-12-23T20:04:50.8897645-05:00","closed_at":"2025-12-23T20:04:50.8897645-05:00","close_reason":"Added consecutive retry tracking with checkpoint warning. 4 unit tests document the logic.","labels":["enhancement","p1"]}
{"id":"zen-aok","title":"Inject zen constitution into IMPLEMENT prompt","description":"Extract GOLDEN RULES, CODE STYLE, TESTING sections from defaults/CLAUDE.md and inject into implement prompt. See docs/plan.md Step 1.3","notes":"Added load_constitution() call to build_implement_prompt(). Injects GOLDEN RULES, CODE STYLE, TESTING.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:35.3504343-05:00","updated_at":"2025-12-25T13:20:08.1018132-05:00","closed_at":"2025-12-25T13:30:00-05:00","labels":["enhancement","phase-1"]}
{"id":"zen-aum","title":"Extract file ops from utils.py to files.py","description":"Move file I/O functions from utils.py to dedicated files.py module: read_file, write_file, backup_file, load_constitution, should_ignore_path, get_changed_filenames. Update imports across codebase.","notes":"Created files.py with IGNORE_DIRS, IGNORE_FILES, BINARY_EXTS, should_ignore_path, read_file, write_file, backup_file, load_constitution, get_full_constitution. utils.py re-exports for backward compatibility.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-26T06:21:20.0651453-05:00","updated_at":"2025-12-26T15:24:26.8246945-05:00","closed_at":"2025-12-26T15:24:26.8246945-05:00","labels":["refactor"]}
{"id":"zen-az0","title":"Context tracking with session threshold reset","description":"Track context and start new sessions when reaching threshold instead of new context for each step. Enables batching work across steps, model builds on its own context. Tradeoff: results become path-dependent, harder to resume.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:18:06.0225881-05:00","updated_at":"2025-12-23T19:18:31.1686412-05:00","labels":["enhancement","p3"]}
{"id":"zen-b57","title":"Replace PLAN GOOD/BAD examples with symbol references","description":"Update PLAN prompt examples to show interfaces-first structure and symbol references instead of line numbers. See docs/plan.md Step 1.2","notes":"Already done - GOOD PLAN example shows interfaces-first with symbol references (User.validate_email(), register_user()).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:33.8772701-05:00","updated_at":"2025-12-25T13:23:14.9186553-05:00","closed_at":"2025-12-25T14:00:00-05:00","labels":["enhancement","phase-1"]}
{"id":"zen-bkn","title":"Lint: Missing return type hints on cmd_init, cmd_run, cmd_swarm, main in cli.py","description":"cli.py functions cmd_init, cmd_run, cmd_swarm, main have no return type hints. All return None implicitly but should be annotated.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:32.8078983-05:00","updated_at":"2025-12-27T09:11:32.9792499-05:00","closed_at":"2025-12-27T09:11:32.9792499-05:00"}
{"id":"zen-bpn","title":"File size annotations in scout output","description":"Add [LARGE] / [MASSIVE] tags to file tree in scout prompt. Prevents model wasting tokens reading massive files. Effort: ~25 LOC","notes":"Added count_lines_safe(), file_size_tag(), annotate_file_sizes() to scout.py. Thresholds: LARGE=500, MASSIVE=2000 lines. Section-aware: only annotates Targeted Files and Context Files, skips Deletion Candidates. 17 tests in test_file_size_annotation.py.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T19:18:03.0019136-05:00","updated_at":"2025-12-25T15:03:29.6680991-05:00","closed_at":"2025-12-25T15:00:00-05:00","labels":["enhancement","p3"]}
{"id":"zen-bsi","title":"Plan: Complete verify.py migration to context-based API","description":"Phase 1: Update all callers (core.py, judge.py) to use _ctx functions. Phase 2: Remove legacy functions and module-level constants. Phase 3: Rename _ctx functions to remove suffix. Files: verify.py, core.py, judge.py. Risk: Breaking change if external code uses legacy API. Verification: All tests pass, grep shows no legacy function calls.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:12:51.321595-05:00","updated_at":"2025-12-27T08:12:51.321595-05:00","dependencies":[{"issue_id":"zen-bsi","depends_on_id":"zen-ofx","type":"blocks","created_at":"2025-12-27T08:13:10.4609656-05:00","created_by":"daemon"},{"issue_id":"zen-bsi","depends_on_id":"zen-3q7","type":"blocks","created_at":"2025-12-27T08:13:11.0097545-05:00","created_by":"daemon"}]}
{"id":"zen-by9","title":"Anti-Pattern: Bare 'except Exception' in git.py (7 occurrences) - silently swallows errors","description":"git.py has 7 bare 'except Exception: pass' blocks that silently swallow errors. While this provides resilience when git isn't available, it makes debugging difficult and hides real problems. Locations: lines 29, 43, 59, 89, 108, 125, 221, 270.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:15.0175193-05:00","updated_at":"2025-12-27T10:03:19.8875544-05:00","closed_at":"2025-12-27T10:03:19.8875544-05:00"}
{"id":"zen-bzh","title":"Rename TestState enum to VerifyState to avoid PytestCollectionWarning","description":"","notes":"Renamed TestState to VerifyState across verify.py, judge.py, test_verify.py, test_constitution_in_fix_prompt.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T07:25:01.4015262-05:00","updated_at":"2025-12-25T08:18:07.2658307-05:00","closed_at":"2025-12-25T08:18:07.2658307-05:00"}
{"id":"zen-cdr","title":"Extract log function from utils.py","description":"Move log() function from utils.py. Could go in context.py (since it uses log_file from Context) or its own logging.py. Update imports across codebase.","notes":"Done: Moved log() to files.py and deleted utils.py entirely. The junk drawer is gone.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-26T06:21:25.0933144-05:00","updated_at":"2025-12-26T19:11:49.1484702-05:00","closed_at":"2025-12-26T16:45:17.7289492-05:00","labels":["refactor"]}
{"id":"zen-cg8","title":"Make linter pure: remove git integration","description":"Remove get_git_changes() from linter.py. Linter should be pure: accept file list, return violations. Caller (CLI, ratchet) handles git integration via git.py. This simplifies testing and separates concerns.","notes":"Linter is now pure: removed get_git_changes() and git import. run_lint() defaults to cwd. implement.py's run_linter_with_timeout() now handles git integration via git.get_changed_files(). All 516 tests pass.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-26T06:31:34.3790546-05:00","updated_at":"2025-12-26T09:05:53.3766753-05:00","closed_at":"2025-12-26T09:05:53.3766753-05:00","labels":["refactor"]}
{"id":"zen-dqh","title":"Add escalation-specific example to IMPLEMENT prompt","description":"Add example showing targeted fix vs over-engineering on Opus escalation. No filler rule. See docs/plan.md Step 1.5","notes":"Added ESCALATION_EXAMPLES block with BAD (over-engineering) and GOOD (targeted fix) examples to build_escalation_suffix().","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:38.47006-05:00","updated_at":"2025-12-25T13:29:51.5453983-05:00","closed_at":"2025-12-25T14:15:00-05:00","labels":["enhancement","phase-1"]}
{"id":"zen-ecd","title":"Extract plan.py from core.py","description":"","notes":"Created plan.py with build_plan_prompt(), parse_steps(), validate_plan_efficiency(), get_completed_steps(), phase_plan_ctx(). Core.py imports these functions from plan.py. Updated test_sync.py for moved functions. get_completed_steps now takes log_file parameter for dependency injection.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:03.7030788-05:00","updated_at":"2025-12-24T20:34:57.49782-05:00","closed_at":"2025-12-24T20:34:57.49782-05:00","labels":["phase-0","refactor"]}
{"id":"zen-eqf","title":"Plan: Add missing return type hints","description":"Solution: Add '-\u003e None' to cli.py functions, add '-\u003e Optional[re.Match]' to get_suppression_match. Files: cli.py, linter.py. Verification: mypy passes or manual review.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:15:27.2974366-05:00","updated_at":"2025-12-27T09:11:33.559155-05:00","closed_at":"2025-12-27T09:11:33.559155-05:00","dependencies":[{"issue_id":"zen-eqf","depends_on_id":"zen-bkn","type":"blocks","created_at":"2025-12-27T08:15:38.8721131-05:00","created_by":"daemon"},{"issue_id":"zen-eqf","depends_on_id":"zen-xed","type":"blocks","created_at":"2025-12-27T08:15:39.3725829-05:00","created_by":"daemon"}]}
{"id":"zen-fca","title":"Lint: Version mismatch between pyproject.toml (1.0.8) and __init__.py (0.1.0)","description":"pyproject.toml version is 1.0.8 but src/zen_mode/__init__.py has __version__ = '0.1.0'. Users running 'zen --version' see wrong version.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:05:59.8350022-05:00","updated_at":"2025-12-27T08:36:29.4647133-05:00","closed_at":"2025-12-27T08:36:29.4647133-05:00"}
{"id":"zen-g1l","title":"Extract git.py module from scattered git operations","description":"Consolidate git operations from linter.py, judge.py, utils.py, scout.py into dedicated git.py module. Functions: is_git_repo(), get_head_commit(), get_changed_files(), get_change_stats(), grep_files(). Add comprehensive tests.","notes":"Created git.py module with: is_repo(), has_head(), get_head_commit(), get_staged_files(), get_unstaged_files(), get_untracked_files(), get_changed_files(), get_diff_stats(), grep_files(). Updated linter.py, judge.py, utils.py to use it. scout.py blocked on zen-3n0 (cross-language grep investigation). All 516 tests pass.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-26T06:31:33.312603-05:00","updated_at":"2025-12-26T07:55:07.4183786-05:00","closed_at":"2025-12-26T07:55:07.4183786-05:00","labels":["refactor"]}
{"id":"zen-gfq","title":"test_scout.py::test_finds_references_via_git_grep fails due to dict ordering - should compare sets or sort before comparing","description":"","notes":"Fixed by comparing sets instead of lists in test assertion","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T07:24:46.8718273-05:00","updated_at":"2025-12-25T08:02:40.4632204-05:00","closed_at":"2025-12-25T08:02:40.4632204-05:00"}
{"id":"zen-hcy","title":"Plan: Improve git.py exception handling","description":"Solution: 1) Add logging for caught exceptions at DEBUG level. 2) Catch specific exceptions (subprocess.CalledProcessError, FileNotFoundError) instead of broad Exception. 3) Return typed result objects with error info instead of silent fallback. Files: git.py. Risk: Low - internal module. Verification: Tests pass, git errors logged when DEBUG enabled.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:13:48.0664661-05:00","updated_at":"2025-12-27T10:03:20.4795515-05:00","closed_at":"2025-12-27T10:03:20.4795515-05:00","dependencies":[{"issue_id":"zen-hcy","depends_on_id":"zen-by9","type":"blocks","created_at":"2025-12-27T08:14:00.209972-05:00","created_by":"daemon"}]}
{"id":"zen-hny","title":"Plan: Replace inline Args classes with SimpleNamespace","description":"Solution: Replace 'class Args: pass; args = Args(); args.x = y' with 'args = SimpleNamespace(x=y)'. Add 'from types import SimpleNamespace'. Files: cli.py. Risk: None - equivalent behavior. Verification: Tests pass.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-27T08:14:45.2743155-05:00","updated_at":"2025-12-27T09:11:35.6202493-05:00","closed_at":"2025-12-27T09:11:35.6202493-05:00","dependencies":[{"issue_id":"zen-hny","depends_on_id":"zen-hok","type":"blocks","created_at":"2025-12-27T08:14:55.7071799-05:00","created_by":"daemon"}]}
{"id":"zen-hok","title":"Anti-Pattern: cli.py uses inline class definitions (lines 129-135) for Args","description":"cli.py lines 129-135 define inline 'class Args: pass' objects to simulate argparse namespace. Works but unconventional - could use SimpleNamespace or dataclass.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:34.4908477-05:00","updated_at":"2025-12-27T09:11:35.045965-05:00","closed_at":"2025-12-27T09:11:35.045965-05:00"}
{"id":"zen-hyi","title":"Extract shared helpers to utils.py + Context dataclass","description":"","notes":"Added to utils.py: Context dataclass, log(), read_file(), write_file(), backup_file(), run_claude(). New signatures support dependency injection for testing. Core.py retains old functions until phases are extracted (0.2-0.5).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:00.7334765-05:00","updated_at":"2025-12-24T20:07:25.9220238-05:00","closed_at":"2025-12-24T20:07:25.9220238-05:00","labels":["phase-0","refactor"]}
{"id":"zen-isk","title":"Plan: Fix allow_real_api_calls fixture","description":"Solution: Fixture needs to stop the autouse fixture's patch. Options: 1) Use pytest_configure to conditionally apply patch, or 2) Make allow_real_api_calls a session fixture that patches back the real function. Simpler: mark tests with @pytest.mark.real_api and check in block_real_api_calls. Files: tests/conftest.py. Verification: Test marked with fixture can actually call API (or mock proves patch removed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T08:14:31.77822-05:00","updated_at":"2025-12-27T08:36:32.691982-05:00","closed_at":"2025-12-27T08:36:32.691982-05:00","dependencies":[{"issue_id":"zen-isk","depends_on_id":"zen-9dg","type":"blocks","created_at":"2025-12-27T08:14:42.3613628-05:00","created_by":"daemon"}]}
{"id":"zen-j6v","title":"Extract Claude API from utils.py to claude.py","description":"Move Claude CLI wrapper from utils.py to dedicated claude.py module: run_claude, _init_claude, _parse_json_response, _extract_cost. Update imports across codebase.","notes":"Created claude.py with run_claude, _init_claude, _parse_json_response, _extract_cost. utils.py re-exports for backward compatibility.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-26T06:21:23.4321126-05:00","updated_at":"2025-12-26T16:44:01.8082082-05:00","closed_at":"2025-12-26T16:44:01.8082082-05:00","labels":["refactor"]}
{"id":"zen-joo","title":"Update imports to use new module locations directly","description":"Currently utils.py is a re-export hub - this is cheating.\n\nUpdate all imports across codebase:\n- Context → from zen_mode.context import Context\n- read_file, write_file, etc → from zen_mode.files import ...\n- run_claude → from zen_mode.claude import run_claude\n\nThen utils.py becomes just the log() function (or remove entirely).\n\nFiles to update:\n- plan.py\n- implement.py\n- judge.py\n- scout.py\n- core.py\n- verify.py\n- tests/*","notes":"Completed: Updated all imports to use direct module paths (context.py, files.py, claude.py). Removed re-exports from utils.py, then moved log() to files.py and deleted utils.py entirely. All 538 tests pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T16:47:14.0960258-05:00","updated_at":"2025-12-26T19:11:47.6835109-05:00","closed_at":"2025-12-26T19:11:47.6835109-05:00"}
{"id":"zen-mii","title":"Add project type and test command detection to scout phase - verify can run tests directly via subprocess instead of asking Claude","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T07:32:27.2423214-05:00","updated_at":"2025-12-25T07:35:15.318317-05:00","closed_at":"2025-12-25T07:35:15.318317-05:00"}
{"id":"zen-ni3","title":"Extract scout.py from core.py","description":"","notes":"Created scout.py with build_scout_prompt() and phase_scout_ctx(). Core.py imports build_scout_prompt from scout.py. Legacy phase_scout() wrapper provided for backward compat. Updated test_sync.py to mark build_scout_prompt as intentionally different.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T19:58:02.1429929-05:00","updated_at":"2025-12-24T20:20:25.132355-05:00","closed_at":"2025-12-24T20:20:25.132355-05:00","labels":["phase-0","refactor"]}
{"id":"zen-npx","title":"Lint: Type hint uses lowercase 'callable' instead of 'Callable' in 6 locations","description":"Using lowercase 'callable' which is the built-in function, not 'Callable' from typing module. Affects: claude.py:58,59, files.py:157, judge.py:113, scout.py:64,236. Works at runtime but incorrect for type checkers.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:11.6753177-05:00","updated_at":"2025-12-27T08:36:31.3171355-05:00","closed_at":"2025-12-27T08:36:31.3171355-05:00"}
{"id":"zen-ofx","title":"Anti-Pattern: verify.py has duplicate functions (phase_verify and phase_verify_ctx, etc.)","description":"verify.py has two parallel APIs: legacy (phase_verify, phase_fix_tests, verify_and_fix) using module-level globals, and context-based (_ctx suffix) using Context object. This is intentional migration but incomplete - legacy API still used by core.py.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:17.0125325-05:00","updated_at":"2025-12-27T08:12:49.7888632-05:00"}
{"id":"zen-oqo","title":"Auto-calculate worker count based on task complexity","description":"Instead of requiring --workers flag, analyze task to determine optimal parallelism. Current: hardcoded default of 2.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T19:17:37.551865-05:00","updated_at":"2025-12-23T20:36:38.5508096-05:00","closed_at":"2025-12-23T20:36:38.5508096-05:00","close_reason":"Auto-calculate workers = min(tasks, cpu_count, 8). Added 5 unit tests for the calculation logic.","labels":["enhancement","p1"]}
{"id":"zen-ot1","title":"Linter: Language-specific rule scoping","description":"Rules like INLINE_IMPORT trigger on non-applicable languages. Add RULE_EXTENSIONS mapping: {'INLINE_IMPORT': {'py','js','ts','tsx','jsx'}, 'POSSIBLE_SECRET': {'*'}, ...}. Location: src/zen_mode/linter.py. Effort: ~40 LOC","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T19:18:02.0556896-05:00","updated_at":"2025-12-23T20:55:03.7830279-05:00","closed_at":"2025-12-23T20:55:03.7830279-05:00","labels":["enhancement","p2"]}
{"id":"zen-p0r","title":"Plan: Fix callable type hints","description":"Solution: Replace 'Optional[callable]' with 'Optional[Callable[..., Any]]' or more specific signatures. Add 'from typing import Callable' where missing. Files: claude.py, files.py, judge.py, scout.py. Verification: mypy passes (if configured) or manual review.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T08:12:00.9476031-05:00","updated_at":"2025-12-27T08:36:30.8136922-05:00","closed_at":"2025-12-27T08:36:30.8136922-05:00","dependencies":[{"issue_id":"zen-p0r","depends_on_id":"zen-npx","type":"blocks","created_at":"2025-12-27T08:12:48.5900639-05:00","created_by":"daemon"}]}
{"id":"zen-p4q","title":"Plan: Migrate print statements to logging","description":"Solution: 1) Configure logging in cli.py with console handler. 2) Replace print() with logger.info() for normal output. 3) Replace print(file=sys.stderr) with logger.error(). 4) Add --verbose/-v flag to enable DEBUG. 5) Keep print() only for direct user prompts (input). Files: All modules. Risk: Output format changes. Verification: Tests pass, --verbose shows debug, normal run shows info only.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-27T08:14:16.6904236-05:00","updated_at":"2025-12-27T08:14:16.6904236-05:00","dependencies":[{"issue_id":"zen-p4q","depends_on_id":"zen-982","type":"blocks","created_at":"2025-12-27T08:14:29.2143109-05:00","created_by":"daemon"}]}
{"id":"zen-qje","title":"Enhance --dry-run output","description":"Current --dry-run output is minimal. Improvements: (1) Print prompts that would be sent, (2) Show which files would be created, (3) Add --verbose flag for details. Effort: ~30 LOC","notes":"Removed --dry-run entirely. Unlike terraform plan, zen cannot predict execution paths without running Claude. The feature was fundamentally broken and architecturally unsound.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T19:18:03.9955581-05:00","updated_at":"2025-12-25T21:35:43.1343447-05:00","closed_at":"2025-12-25T21:35:43.1343447-05:00","labels":["enhancement","p3"]}
{"id":"zen-qos","title":"Phase 3 requirement: Log visibility - show when direct test runner is used vs LLM fallback, include timing and reason for fallback","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T07:40:24.1599286-05:00","updated_at":"2025-12-25T07:40:24.1599286-05:00","labels":["needs-planning"]}
{"id":"zen-rc9","title":"Plan: Encapsulate swarm status display state","description":"Solution: Create StatusDisplay class that tracks line count internally. Or pass prev_line_count as parameter and return new count. Files: swarm.py. Risk: None. Verification: Tests pass, swarm output unchanged.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-27T08:14:58.9715344-05:00","updated_at":"2025-12-27T10:26:58.9421541-05:00","closed_at":"2025-12-27T10:26:58.9421541-05:00","dependencies":[{"issue_id":"zen-rc9","depends_on_id":"zen-5sf","type":"blocks","created_at":"2025-12-27T08:15:10.7993725-05:00","created_by":"daemon"}]}
{"id":"zen-sap","title":"Add few-shot scope examples to IMPLEMENT prompt","description":"Add GOOD/BAD examples showing scope discipline - minimal complete vs scope creep. See docs/plan.md Step 1.4","notes":"Added EXAMPLES block with BAD (scope creep) and GOOD (minimal complete) examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T19:58:36.7845876-05:00","updated_at":"2025-12-25T13:20:21.8424863-05:00","closed_at":"2025-12-25T13:30:00-05:00","labels":["enhancement","phase-1"]}
{"id":"zen-sfa","title":"Research language-agnostic lint/verification tools","description":"Research options for extensions package. Requirements:\n- Language agnostic (or covers many languages)\n- CLI-based (can shell out to it)\n- JSON/structured output preferred\n- Actively maintained\n\nCategories to research:\n\n**Linting/Static Analysis:**\n- semgrep (known - multi-lang, pattern-based)\n- trunk (meta-linter?)\n- megalinter (meta-linter)\n- sonarqube (heavy?)\n- others?\n\n**Testing/Verification:**\n- playwright (known - browser testing)\n- alternatives?\n\n**Security:**\n- semgrep (overlaps with lint)\n- others?\n\nQuestions to answer:\n1. What tools cover the most languages with one install?\n2. What's the maintenance/community health?\n3. How easy is output parsing?\n4. What's the install footprint?\n5. Can they run offline / no cloud dependency?","notes":"Research complete. Decision: Keep custom linter for now.\n\nFindings:\n- Opengrep/Semgrep: Powerful (AST-based, 30+ langs, LGPL 2.1 - no conflict if subprocess)\n- But: Adds install complexity, would need to rewrite rules in YAML\n- Our linter already covers AI artifacts, secrets, TODOs - patterns unique to our use case\n\nStrategy:\n- Run linter on HIGH severity (block on real bugs)\n- Log MEDIUM as warnings\n- Revisit Opengrep when cross-file taint analysis needed or maintenance burden grows\n\nNext: Implement lint ratchet (zen-90k, zen-9qs) with current linter.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:41:22.3740782-05:00","updated_at":"2025-12-26T16:33:40.7219867-05:00","closed_at":"2025-12-26T16:33:40.7219867-05:00"}
{"id":"zen-sr2","title":"Add preflight check for source files and task clarity","description":"Before coding, verify: (1) Do you have the source code for files to edit? (2) Is the task clearly defined? Output machine-parseable PREFLIGHT: FILES=YES/NO, TASK=YES/NO. Abort with STEP_BLOCKED if NO.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T19:17:39.6188045-05:00","updated_at":"2025-12-23T20:18:57.8720787-05:00","closed_at":"2025-12-23T20:18:57.8720787-05:00","close_reason":"Added \u003cpreflight\u003e block to implement prompts. Agent verifies files and task clarity before coding, outputs STEP_BLOCKED if either is missing.","labels":["enhancement","p1"]}
{"id":"zen-tor","title":"Plan: Eliminate global state in core.py","description":"Depends on verify.py migration completing first. Solution: Pass Context object through entire call chain. Remove module-level path constants. Update config.py to only define defaults, not runtime state. Files: core.py, config.py, all phase modules. Risk: Large refactor touching many files. Verification: Tests pass, concurrent zen runs work.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:13:13.9314919-05:00","updated_at":"2025-12-27T08:13:13.9314919-05:00","dependencies":[{"issue_id":"zen-tor","depends_on_id":"zen-5rl","type":"blocks","created_at":"2025-12-27T08:13:45.1780897-05:00","created_by":"daemon"},{"issue_id":"zen-tor","depends_on_id":"zen-bsi","type":"blocks","created_at":"2025-12-27T08:13:45.5975368-05:00","created_by":"daemon"}]}
{"id":"zen-ty5","title":"Add tests for untested linter functions","description":"Add tests for: format_report() (JSON, SARIF, text formats), load_config() (.lintrc.json loading), print_rules() output. These are currently untested paths.","notes":"Added 17 tests for load_config() (6), format_report() (8), print_rules() (3). All tests pass.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-26T06:31:35.4766195-05:00","updated_at":"2025-12-26T09:22:54.7303772-05:00","closed_at":"2025-12-26T09:22:54.7303772-05:00","labels":["testing"]}
{"id":"zen-u0o","title":"Documentation cleanup and organization","description":"Current docs mess: user-facing mixed with internal design docs, no Fast Track docs, no index/navigation, README out of sync and bloated. Need clear distinction between 'how it works' vs 'planned improvements'.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:18:07.1659115-05:00","updated_at":"2025-12-23T19:18:31.487825-05:00","labels":["docs","p3"]}
{"id":"zen-xed","title":"Lint: Missing return type hint on get_suppression_match in linter.py:177","description":"linter.py get_suppression_match (line 177) returns Optional[re.Match] but has no return type annotation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:06:52.1948865-05:00","updated_at":"2025-12-27T09:11:37.1253227-05:00","closed_at":"2025-12-27T09:11:37.1253227-05:00"}
{"id":"zen-yd4","title":"Plan: Fix unicode handling in test subprocess","description":"Solution: In test fixtures that spawn subprocesses, set encoding='utf-8' and errors='replace' on Popen. Or use subprocess.run with text=True and errors='replace'. Files: tests/test_verify_languages.py. Verification: pytest runs without UnicodeDecodeError warning.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:15:42.3854805-05:00","updated_at":"2025-12-27T09:11:39.3094433-05:00","closed_at":"2025-12-27T09:11:39.3094433-05:00","dependencies":[{"issue_id":"zen-yd4","depends_on_id":"zen-9u5","type":"blocks","created_at":"2025-12-27T08:15:51.9533853-05:00","created_by":"daemon"}]}
{"id":"zen-z23","title":"Fix ticker display bug (progress going backwards)","description":"Swarm ticker showed '2/3 done' then '1/3 done' - progress went backwards. Need to investigate status collection logic in swarm.py:640.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T19:17:38.5611071-05:00","updated_at":"2025-12-23T20:28:16.1598414-05:00","closed_at":"2025-12-23T20:28:16.1598414-05:00","close_reason":"Added high-water mark tracking to prevent ticker from showing backwards progress. Defensive fix for edge cases.","labels":["bug","p1"]}
{"id":"zen-zds","title":"Break up core.py god class","description":"core.py is 1000+ LOC single file. Target structure: state.py (WorkDir, TaskState), planner.py (Scout, Plan), hands.py (Implement), judge.py (Judge), files.py (helpers). Effort: ~200+ LOC refactor. Defer until pain point.","notes":"Superseded by granular Phase 0 beads: zen-hyi, zen-ni3, zen-ecd, zen-5yo, zen-10o, zen-4q0, zen-4qp","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T19:18:05.0147069-05:00","updated_at":"2025-12-24T20:00:05.8694156-05:00","closed_at":"2025-12-24T20:00:05.8694156-05:00","labels":["p3","refactor"]}
